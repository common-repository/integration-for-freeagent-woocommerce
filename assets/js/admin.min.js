jQuery(document).ready(function(e){var t={settings_groups:["coupon","vatnumber","emails","email-notify","receipt","accounting"],init:function(){this.init_toggle_groups(),e("#woocommerce_wc_freeagent_pro_email").keypress(this.submit_pro_on_enter),e("#woocommerce_wc_freeagent_pro_key-submit").on("click",this.submit_activate_form),e("#woocommerce_wc_freeagent_pro_key-deactivate").on("click",this.submit_deactivate_form),e("#wc_freeagent_auth_logout").on("click",this.logout),e("#wc_freeagent_authenticate").on("click",this.start_authenticate)},start_authenticate:function(){var t=e(this).data("nonce"),o=e("#wc_freeagent_auth_client_id_field").val(),i=e("#wc_freeagent_auth_client_secret_field").val(),a={action:"wc_freeagent_authenticate",nonce:t,client_id:o,client_secret:i,sandbox:e("#wc_freeagent_auth_sandbox").is(":checked")};return i&&o?(n.loading_indicator(e(".wc-freeagent-section-auth-step-3"),"#f1f1f1"),e.post(ajaxurl,a,function(t){e(".wc-freeagent-section-auth-step-3").unblock(),t.data.error||(window.location.href=t.data.auth_url)}),!1):(e(".wc-freeagent-section-auth-client-fields").addClass("validate"),setTimeout(function(){e(".wc-freeagent-section-auth-client-fields").removeClass("validate")},1e3),!1)},logout:function(){alert("shit");var t={action:"wc_freeagent_logout",nonce:e(this).data("nonce")};return n.loading_indicator(e(".wc-freeagent-section-authenticated"),"#fff"),e.post(ajaxurl,t,function(t){e(".wc-freeagent-section-authenticated").unblock(),t.data.error||window.location.reload()}),!1},init_toggle_groups:function(){e.each(t.settings_groups,function(t,n){var o=e(".wc-freeagent-toggle-group-"+n),i=e(".wc-freeagent-toggle-group-"+n+"-item").parents("tr"),a=o.is(":checked");"emails"==n&&e(".wc-freeagent-toggle-group-"+n+":checked").length&&(a=!0),a?i.show():i.hide(),o.change(function(t){t.preventDefault();var o=e(this).is(":checked");"emails"==n&&e(".wc-freeagent-toggle-group-"+n+":checked").length&&(o=!0),o?i.show():i.hide()})})},submit_pro_on_enter:function(t){if(13==t.which)return e(this).parent().find("button").click(),!1},submit_activate_form:function(){var t=e("#woocommerce_wc_freeagent_pro_key").val(),n=e("#woocommerce_wc_freeagent_pro_email").val(),o=e(this).parents(".wc-freeagent-section-pro"),i={action:"wc_freeagent_pro_check",key:t,email:n};return o.block({message:null,overlayCSS:{background:"#ffffff url("+wc_freeagent_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),o.find(".notice").hide(),e.post(ajaxurl,i,function(e){e.success?window.location.reload():(o.find(".notice p").html(e.data.message),o.find(".notice").show(),o.unblock())}),!1},submit_deactivate_form:function(){var t=e(this).parents(".wc-freeagent-section-pro");return t.block({message:null,overlayCSS:{background:"#ffffff url("+wc_freeagent_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}}),t.find(".notice").hide(),e.post(ajaxurl,{action:"wc_freeagent_pro_deactivate"},function(e){e.success?window.location.reload():(t.find(".notice p").html(e.data.message),t.find(".notice").show(),t.unblock())}),!1}},n={prefix:"wc_freeagent_",prefix_id:"#wc_freeagent_",prefix_class:".wc-freeagent-",$metaboxContent:e("#wc_freeagent_metabox .inside"),$disabledState:e(".wc-freeagent-metabox-disabled"),$optionsContent:e(".wc-freeagent-metabox-generate-options"),$autoMsg:e(".wc-freeagent-metabox-auto-msg"),$generateContent:e(".wc-freeagent-metabox-generate"),$optionsButton:e("#wc_freeagent_invoice_options"),$generateButtonInvoice:e("#wc_freeagent_invoice_generate"),$invoiceRow:e(".wc-freeagent-metabox-invoices-invoice"),$voidedRow:e(".wc-freeagent-metabox-invoices-void"),$voidedReceiptRow:e(".wc-freeagent-metabox-invoices-void_receipt"),$completeRow:e(".wc-freeagent-metabox-rows-data-complete"),$voidRow:e(".wc-freeagent-metabox-rows-data-void"),$messages:e(".wc-freeagent-metabox-messages"),nonce:e(".wc-freeagent-metabox-content").data("nonce"),order:e(".wc-freeagent-metabox-content").data("order"),init:function(){this.$optionsButton.on("click",this.show_options),e(this.prefix_class+"invoice-toggle").on("click",this.toggle_invoice),this.$generateButtonInvoice.on("click",this.generate_invoice),this.$completeRow.find("a").on("click",this.mark_completed),this.$voidRow.find("a").on("click",this.void_invoice),this.$messages.find("a").on("click",this.hide_message)},loading_indicator:function(e,t){n.hide_message(),e.block({message:null,overlayCSS:{background:t+" url("+wc_freeagent_params.loading+") no-repeat center",backgroundSize:"16px 16px",opacity:.6}})},show_options:function(){n.$optionsContent.slideToggle()},toggle_invoice:function(){var t="";if(e(this).hasClass("off")&&!(t=prompt("Turning off invoicing for this order. Whats the reason?","I don't need an invoice for this order.")))return!1;var o={action:n.prefix+"toggle_invoice",nonce:n.nonce,order:n.order,note:t};return n.loading_indicator(n.$metaboxContent,"#fff"),e.post(ajaxurl,o,function(e){n.$disabledState.find("span").text(t),n.$metaboxContent.unblock(),"off"==e.data.state?(n.$disabledState.slideDown(),n.$optionsContent.slideUp(),n.$autoMsg.slideUp(),n.$generateContent.slideUp(),n.$voidedRow.slideUp()):(n.$disabledState.slideUp(),n.$autoMsg.slideDown(),n.$generateContent.slideDown())}),!1},generate_invoice:function(){var t=e(this),o="invoice";if(1!=confirm(t.data("question")))return!1;var i=e("#wc_freeagent_invoice_note").val(),a=e("#wc_freeagent_invoice_deadline").val(),c=e("#wc_freeagent_invoice_completed").val();e("#wc_freeagent_invoice_estimate").is(":checked")&&(o="estimate");var r={action:n.prefix+"generate_invoice",nonce:n.nonce,order:n.order,note:i,deadline:a,completed:c,type:o};return n.loading_indicator(n.$metaboxContent,"#fff"),e.post(ajaxurl,r,function(e){n.$metaboxContent.unblock(),n.show_messages(e),e.data.error||"invoice"==e.data.type&&(n.$autoMsg.slideUp(),n.$generateContent.slideUp(),n.$voidedRow.slideUp(),n.$invoiceRow.find("strong").text(e.data.name),n.$invoiceRow.find("a").attr("href",e.data.link),n.$invoiceRow.slideDown(),n.$completeRow.slideDown(),n.$voidRow.slideDown(),e.data.completed&&(n.$completeRow.find("a").addClass("completed"),n.$completeRow.find("a").text(e.data.completed)))}),!1},mark_completed_timeout:!1,mark_completed:function(){var t=e(this);if(t.hasClass("completed"))return!1;if(t.hasClass("confirm")){clearTimeout(n.mark_completed_timeout),n.loading_indicator(n.$completeRow,"#fff");var o={action:n.prefix+"mark_completed",nonce:n.nonce,order:n.order};e.post(ajaxurl,o,function(e){n.$completeRow.unblock(),n.show_messages(e),e.data.error?t.fadeOut(function(){t.text(t.data("trigger-value")),t.removeClass("confirm"),t.fadeIn()}):t.fadeOut(function(){t.text(e.data.completed),t.addClass("completed"),t.fadeIn(),t.removeClass("confirm")})})}else n.mark_completed_timeout=setTimeout(function(){t.fadeOut(function(){t.text(t.data("trigger-value")),t.fadeIn(),t.removeClass("confirm")})},5e3),t.addClass("confirm"),t.fadeOut(function(){t.text("Are you sure?"),t.fadeIn()})},void_invoice_timeout:!1,void_invoice:function(){var t=e(this);if(t.hasClass("confirm")){clearTimeout(n.void_invoice_timeout),n.loading_indicator(n.$voidRow,"#fff");var o=n.is_receipt?"void_receipt":"void_invoice",i={action:n.prefix+o,nonce:n.nonce,order:n.order};e.post(ajaxurl,i,function(e){n.$voidRow.unblock(),n.show_messages(e),e.data.error||(n.$invoiceRow.slideUp(),n.$completeRow.slideUp(),n.$voidRow.slideUp(function(){t.text(e.data.completed),t.removeClass("confirm")}),n.$generateContent.slideDown(),n.$autoMsg.slideDown(),n.$voidedRow.find("strong").text(e.data.name),n.$voidedRow.find("a").attr("href",e.data.link),n.$voidedRow.slideDown()),t.fadeOut(function(){t.text(t.data("trigger-value")),t.fadeIn(),t.removeClass("confirm")})})}else n.void_invoice_timeout=setTimeout(function(){t.fadeOut(function(){t.text(t.data("trigger-value")),t.fadeIn(),t.removeClass("confirm")})},5e3),t.addClass("confirm"),t.fadeOut(function(){t.text(t.data("question")),t.fadeIn()})},show_messages:function(t){t.data.messages&&t.data.messages.length>0&&(this.$messages.removeClass("wc-freeagent-metabox-messages-success"),this.$messages.removeClass("wc-freeagent-metabox-messages-error"),t.data.error?this.$messages.addClass("wc-freeagent-metabox-messages-error"):this.$messages.addClass("wc-freeagent-metabox-messages-success"),$ul=this.$messages.find("ul"),$ul.html(""),e.each(t.data.messages,function(t,n){var o=e("<li>");o.append(n),$ul.append(o)}),this.$messages.slideDown())},hide_message:function(){return n.$messages.slideUp(),!1}};e(".wc-freeagent-notice .wc-freeagent-hide-notice").on("click",function(t){t.preventDefault();var n=e(this).closest(".wc-freeagent-notice");if(e(n).find(".wc-freeagent-wait").remove(),e(n).append('<div class="wc-freeagent-wait"></div>'),e(".wc-freeagent-notice.updating").length>0){var o=e(this);return setTimeout(function(){o.triggerHandler("click")},100),!1}e(n).addClass("updating"),e.post(ajaxurl,{action:"wc_freeagent_hide_notice",security:e(this).data("nonce"),notice:e(this).data("notice"),remind:e(this).hasClass("remind-later")?"yes":"no"},function(){e(n).removeClass("updating"),e(n).fadeOut(100)})});var o={$menu_bar_item:e("#wp-admin-bar-wc-freeagent-bg-generate-loading"),$link_stop:e("#wc-freeagent-bg-generate-stop"),$link_refresh:e("#wc-freeagent-bg-generate-refresh"),finished:!1,nonce:"",init:function(){this.$link_stop.on("click",this.stop),this.$link_refresh.on("click",this.reload_page),this.nonce=this.$link_stop.data("nonce");var e=this.refresh;setTimeout(e,5e3)},reload_page:function(){return location.reload(),!1},stop:function(){var t={action:"wc_freeagent_bg_generate_stop",nonce:o.nonce};return e.post(ajaxurl,t,function(e){o.mark_stopped()}),!1},refresh:function(){var t={action:"wc_freeagent_bg_generate_status",nonce:o.nonce};o.finished||e.post(ajaxurl,t,function(e){e.data.finished?o.mark_finished():setTimeout(o.refresh,5e3)})},mark_finished:function(){this.finished=!0,this.$menu_bar_item.addClass("finished")},mark_stopped:function(){this.mark_finished(),this.$menu_bar_item.addClass("stopped")}},i={init:function(){var t=e("#wc-freeagent-bulk-print");e("#wc-freeagent-bulk-download");t.on("click",this.printInvoices),t.length&&t.trigger("click")},printInvoices:function(){var t=e(this).data("pdf");if("function"==typeof printJS)return printJS(t),!1}};e("#wc_freeagent_metabox").length&&n.init(),(e(".wc-freeagent-section-auth").length||e("#woocommerce_wc_freeagent_section_invoice").length)&&t.init(),e("#wp-admin-bar-wc-freeagent-bg-generate-loading").length&&o.init(),e(".wc-freeagent-bulk-actions").length&&i.init()});